---
- name: Filter the assets based on the given list of extensions
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    sort_prompt: ['deb', 'appimage', 'tar.gz', '']
    asset_list: [k9s_Darwin_amd64.tar.gz, k9s_Darwin_amd64.tar.gz.sbom, k9s_Darwin_arm64.tar.gz, k9s_Darwin_arm64.tar.gz.sbom, k9s_Freebsd_amd64.tar.gz, k9s_Freebsd_amd64.tar.gz.sbom, k9s_Freebsd_arm64.tar.gz, k9s_Freebsd_arm64.tar.gz.sbom, k9s_Freebsd_armv7.tar.gz, k9s_Freebsd_armv7.tar.gz.sbom, k9s_linux_amd64.apk, k9s_linux_amd64.deb, k9s_linux_amd64.rpm, k9s_Linux_amd64.tar.gz, k9s_Linux_amd64.tar.gz.sbom, k9s_linux_arm.apk, k9s_linux_arm.deb, k9s_linux_arm.rpm, k9s_linux_arm64.apk, k9s_linux_arm64.deb, k9s_linux_arm64.rpm, k9s_Linux_arm64.tar.gz, k9s_Linux_arm64.tar.gz.sbom, k9s_Linux_armv7.tar.gz, k9s_Linux_armv7.tar.gz.sbom, k9s_linux_ppc64le.apk, k9s_linux_ppc64le.deb, k9s_linux_ppc64le.rpm, k9s_Linux_ppc64le.tar.gz, k9s_Linux_ppc64le.tar.gz.sbom, k9s_linux_s390x.apk, k9s_linux_s390x.deb, k9s_linux_s390x.rpm, k9s_Linux_s390x.tar.gz, k9s_Linux_s390x.tar.gz.sbom, k9s_Windows_amd64.zip, k9s_Windows_amd64.zip.sbom, k9s_Windows_arm64.zip, k9s_Windows_arm64.zip.sbom]
    asset_list_extensions: >
      {{ asset_list | map('split', '.', 1) | map(attribute='1', default='') }}
    asset_list_zipped: >
      {{ asset_list | zip(asset_list_extensions) }}
    asset_list_filtered: []
  tasks:
    - name: Debug1
      ansible.builtin.debug:
        msg:
          - "ext: {{ asset_list_extensions }}"
          - "zip: {{ asset_list_zipped }}"

    - name: Filter the assets
      ansible.builtin.set_fact:
        asset_list_filtered: >
          {{
            asset_list_filtered + asset_list_zipped | selectattr(1, 'equalto', item)
          }}
      loop: "{{ sort_prompt }}"
      register: result

    - name: Display the results
      vars:
        asset_list_filtered: "{{ asset_list_filtered | map(attribute='0') }}"
      ansible.builtin.debug:
        msg: 
          - "filtered: {{ asset_list_filtered }}"
          - "result: {{ result }}"
        
